<meta charset="UTF-8">
<html>

<head>
    <title>oxDNA three.js viewer</title>
    <!--Nice icons, from http://google.github.io/material-design-icons/-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Link external stylesheet file-->
    <link rel="stylesheet" href="style.css">
    <!--Set favicon-->
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
</head>

<body>
    <!--Keyboard shortcut modal-->
    <div id="keyboardShortcuts" class="modal" onclick="toggleModal(this.id)">
        <div class="modal-content">
            <table>
                <tr>
                    <th>Key</th>
                    <th>Action</th>
                </tr>
				<tr><td>p</td><td>Save image</td></tr>
				<tr><td>s</td><td>Toggle selection mode</td></tr>
				<tr><td>d</td><td>Toggle dragging mode</td></tr>
                <tr><td>Right arrow</td><td>Next configuration</td></tr>
				<tr><td>Left arrow</td><td>Previous configuration</td></tr>
				<tr><td>ctrl-s</td><td>Save topology and configuration</td></tr>
				<tr><td>ctrl-z</td><td>Undo edit</td></tr>
				<tr><td>ctrl-shift-z (or ctrl-y)</td><td>Redo edit</td></tr>
				<tr><td>ctrl-a</td><td>Select all elements</td></tr>
				<tr><td>ctrl-i</td><td>Invert selection</td></tr>
				<tr><td>ctrl-click</td><td>Select multiple elements</td></tr>
				<tr><td>shift-click</td><td>Select intermediate monomers</td></tr>
				<tr><td>Numpad1</td><td>Move camera to x-axis (ctrl to invert)</td></tr>
				<tr><td>Numpad2</td><td>Rotate camera down</td></tr>
				<tr><td>Numpad3</td><td>Move camera to y-axis (ctrl to invert)</td></tr>
				<tr><td>Numpad4</td><td>Rotate camera left</td></tr>
				<tr><td>Numpad5</td><td>Reset camera</td></tr>
				<tr><td>Numpad6</td><td>Rotate camera right</td></tr>
				<tr><td>Numpad7</td><td>Move camera to z-axis (ctrl to invert)</td></tr>
                <tr><td>Numpad8</td><td>Rotate camera up</td></tr>
                <tr><td>F1</td><td>Show this list</td></tr>
            </table>
        </div>
    </div>

    <!--Pause notices-->
    <div id="pause" class="modal"></div>

    <!--Initial instructions for drag and drop of files-->
    <div id="dragInstruction">Drag and drop oxDNA .conf and .top files below</div>

    <!--Sidebar-->
    <div id="sidenav">
        <div id="sidenavContent">
            <button onclick="toggleModal('keyboardShortcuts')" type="button" title="Show keyboard shortcuts">Keyboard shortcuts</button>
            <button onclick="toggleOptions('fileOptions')" type="button" title="Options for downloading the current scene">Download Output Files</button>
            <button onclick="toggleOptions('videoOptions')" type="button" title="Create a video of the trajectory starting with the current frame">Create Video</button>

            <!--Centering-->
            <fieldset>
                <legend>PBC / Centering</legend>
                <caption> PBC: </caption>
                <select id="inboxing" title="At what scale to apply periodic boundary conditions">
                    <option>Monomer</option>
                    <option>Strand</option>
                    <option>None</option>
                </select>
                <br>
                <caption>Centering:</caption>
                <select id="centering" title="Where to center the structure relative to the simulation box">
                    <option>Origin</option>
                    <option>Box Center</option>
                    <option>None</option>
                </select>
                <br>
                <button onclick="systems.forEach( (s) => { PBCswitchbox(s)}); render()" type="button" title="note this only works if you're going from none to something else or if you want to re-center after moving">Apply</button>
            </fieldset>

            <!--View-->
            <fieldset>
                <legend>View</legend>
                <input type="checkbox" id="arrowToggle" onchange="toggleArrows(this)" title="Show/hide the coordinate axes" checked>Display Arrows<br>
                <fieldset>
                    <legend>Color by:</legend>
                    <input type="radio" name="coloring" value="Strand" onchange="coloringChanged()" checked>Strand
                    <input type="radio" name="coloring" value="Cluster" onchange="coloringChanged()">Cluster
                    <input type="radio" name="coloring" value="System" onchange="coloringChanged()">System
                    <input type="radio" name="coloring" value="Overlay" onchange="coloringChanged()">Overlay
                </fieldset>
                <input type="checkbox" id="backgroundToggle" onchange="toggleBackground()" title="White or black background?">Toggle Background Color<br>
                <button onclick="toggleOptions('colorOptions'); colorOptions()" type="button" title="modify the default strand colors">Edit
                    Colors</button>
                <button onclick="controls.reset()" type="button" title="moves camera to default position (100,0,0)">Reset Camera</button>
                <button onclick="api.switchCamera()" id="cameraSwitch" type="button" title="Switches between perspective and orthographic cameras">Orthographic</button>
                <button onclick="toggleOptions('fogOptions')" type="button" title="View fog options">Fog</button>
            </fieldset>

            <!--Edit-->
            <fieldset>
                <legend>Edit</legend>
                <div style="text-align: center;">
                    <i class="material-icons" onclick="editHistory.undo()" title="Undo edit (ctrl-z)">undo</i>
                    <i class="material-icons" onclick="editHistory.redo()" title="Redo edit (ctrl-shift-z)">redo</i>
                </div>
                <input type="checkbox" name="action" id="selectToggle" value="Select" checked title="Hold down ctrl for multiple selection"> Select
                <input type="checkbox" name="action" id="dragToggle" value="Drag"> Drag<br>
                <fieldset>
                    <legend>Selection mode:</legend>
                    <input type="radio" name="scope" value="Monomer" checked>Monomer<br>
                    <input type="radio" name="scope" value="Strand">Strand<br>
                    <input type="radio" name="scope" value="System">System<br>
                    <input type="radio" name="scope" value="Cluster" title="Select by clusters calculated by DBSCAN" onchange="if (typeof elements[0].clusterId == 'undefined') {toggleOptions('clusterOptions');}"> Cluster <i class="material-icons" onclick="toggleOptions('clusterOptions')"
                        title="Clustering options" style="font-size: 1.5em; vertical-align: middle">tune</i><br>
                    <input type="radio" name="scope" value="Box" title="Draw a rectangle and select everything within it">Box<br>
                </fieldset>
                <fieldset>
                    <legend>Rotate:</legend>
                    Axis:
                    <input type="radio" name="rotate" value="X" checked><span style="color: rgb(206, 54, 27)">X</span>
                    <!--default checked is x-axis-->
                    <input type="radio" name="rotate" value="Y"><span style="color: rgb(19, 102, 2)">Y</span>
                    <input type="radio" name="rotate" value="Z"><span style="color: rgb(30, 96, 196)">Z</span><br> Rotation angle:
                    <input type="number" value="-90" id="rotAngle" width="20">
                    <button onclick="rotateByInput()" title="rotate selected objects around center of mass specified by the selection mode by the rotation angle">Rotate</button>
                </fieldset>
                <fieldset>
                    <legend>Edit Topology</legend>
                    <button onclick="nickWrapper()" title="break the upstream connection of the last selected particles">Nick</button>
                    <button onclick="deleteWrapper()" title="delete the selected monomers">Delete</button>
                    <button onclick="ligateWrapper()" title="ligate the last two selected particles together">Ligate</button><br>
                    Sequence:<input type="text" id="sequence" size="10" style="text-transform: uppercase;">
                    <button onclick="setSeqWrapper()" title="Apply the given sequence to the selected monomers">Set sequence</button>
                    <input type="checkbox" id="setCompl" title="Set also complementary bases" checked> Set compl<br>
                    <button onclick="extendWrapper()" title="Extend strand from the selected monomer with the given sequence">Extend</button>
                    <button onclick="createWrapper()" title="Create a new strand with the provided sequences">Create</button>
                </fieldset>
                <input type="checkbox" id="clusterSim" onchange="toggleClusterSim()">Rigid cluster dynamics<br>
            </fieldset>

            <!--Selected bases-->
            <fieldset>
                <legend>Selected bases</legend>
                <textarea id="BaseList" cols="25" rows="3" name="textarea" readonly> Selected Bases List </textarea>
                <button onclick="toggleOptions('baseInfoWindow')" type="button" title="Show selected base information">Show selected base info</button>
                <button onclick="makeSelectedBasesFile()" type="button" title="Download plain-text file of selected bases">Download Selected Base List</button>
                <button onclick="makeMutualTrapFile()" type="button" title="Create mutual trap file pairing every two bases in the selected base list">Make Mutual Trap File</button>
            </fieldset>

            <div style="text-align: center;">
                <i class="material-icons" onclick="trajReader.previousConfig()" style="font-size: 48px;" title="Previous config (left keyboard arrow)">keyboard_arrow_left</i>
                <i class="material-icons" onclick="trajReader.nextConfig()" style="font-size: 48px;" title="Next config (right keyboard arrow)">keyboard_arrow_right</i>
            </div>
        </div>
        <button id="sideNavToggleButton" onclick="toggleSideNav()" type="button" style="background-color: #acc; border: 0px; height: 20px; padding: 0px;">hide toolbar</button>
    </div>

    <!--Extra option windows-->
    <div style="position: absolute; bottom: 0px; overflow-y: scroll; max-height: 100%;">
        <!--Video-->
        <div class="opts" id="videoOptions" hidden="true">
            <div style="text-align: right; background-color: #acc">
                <i class="material-icons" onclick="toggleOptions('videoOptions')">close</i>
            </div>
            <label for="videoType">Video type:</label>
            <select id="videoType" onchange="document.getElementById('videoLeminiscateOpts').hidden = this.selectedIndex == 0;">
                <option value="trajectory">Trajectory</option>
                <option value="lemniscate">XY lemniscate</option>
            </select>
            <fieldset>
                <legend>File format:</legend>
                <input type="radio" name="videoFormat" value="webm" checked>webm<br>
                <input type="radio" name="videoFormat" value="gif">gif<br>
                <input type="radio" name="videoFormat" value="png">png<br>
                <input type="radio" name="videoFormat" value="jpg">jpg<br>
            </fieldset>
            <label for="videoFramerate">Framerate:</label>
            <input type="number" value="24" id="videoFramerate" width="20">fps
            <div id="videoLeminiscateOpts" hidden="true">
                <label for="videoDuration">Duration:</label>
                <input type="number" value="20" id="videoDuration" width="20">s
            </div>
            <button id="videoStartStop" onclick="createVideo()">Start</button>
        </div>

        <!--Color-->
        <div class="opts" id="colorOptions" hidden="true">
            <div style="text-align: right; background-color: #acc">
                <i class="material-icons" onclick="toggleOptions('colorOptions'); colorOptions()">close</i>
            </div>
            Click a color to edit, right click to remove:
            <div id="colorOptionContent" style="background-color: inherit"></div>
        </div>

        <!--File Output-->
        <div class="opts" id="fileOptions" hidden="true">
            <div style="text-align: right; background-color: #acc">
                <i class="material-icons" onclick="toggleOptions('fileOptions')">close</i>
            </div>
            <fieldset>
                <legend>Options</legend>
                <input type="checkbox" name="topDownload" title="identies and connections of particles" checked>Topology<br>
                <input type="checkbox" name="datDownload" title="the xyz positions and rotations of particles" checked>Configuration<br>
                <input type="checkbox" name="cleanFirst" title="If checked, will organize the strands by length.  Must be checked if the topology has been edited.">Pre-organize strands<br>
                <input type="text" id="outputFilename" value="output" title="The prefix to name the .dat and .top files">File prefix<br>
                <button onclick="makeOutputFiles()" title="Download the specified files">Download Files</button>
            </fieldset>
        </div>

        <!--Clustering-->
        <div class="opts" id="clusterOptions" hidden="true">
            <div style="text-align: right; background-color: #acc">
                <i class="material-icons" onclick="toggleOptions('clusterOptions')">close</i>
            </div>
            <fieldset>
                <legend>Automatic</legend>
                <label for="minPts">Min points: </label>
                <input type="number" value="6" id="minPts" title="Minimum number of nucleotides in a cluster" min=1><br>
                <label for="epsilon">Max dist (ε): </label>
                <input type="number" value="1.5" id="epsilon" title="Max distance between cluster neigbours" min=0>
                <button onclick="calculateClusters()">Start clustering</button>
            </fieldset>
            <fieldset>
                <legend>Manual</legend>
                <button onclick="selectionToCluster()" title="Add all selected elements to a new cluster">Selection to
                    cluster</button>
                <button onclick="clearClusters()" title="Remove all clusters">Clear clusters</button>
            </fieldset>
        </div>

        <!--Fog-->
        <div class="opts" id="fogOptions" hidden="true">
            <div style="text-align: right; background-color: #acc">
                <i class="material-icons" onclick="toggleOptions('fogOptions')">close</i>
            </div>
            <label for="fogNear">Near: </label>
            <input type="number" value="1" id="fogNear" title="Minimum distance to apply fog" min=0 onchange="if(scene.fog!=null){setFog();}"><br>
            <label for="fogNear">Far: </label>
            <input type="number" value="200" id="fogFar" title="Maximum distance to apply fog" min=0 onchange="if(scene.fog!=null){setFog();}"><br>
            <button onclick="toggleFog()">Toggle fog</button>
        </div>

        <!--Base info-->
        <div class="opts" id="baseInfoWindow" hidden="true">
            <div style="text-align: right; background-color: #acc">
                <i class="material-icons" onclick="toggleOptions('baseInfoWindow')">close</i>
            </div>
            Selected Base Info:
            <textarea id="BaseInfo" cols="25" rows="10" name="textarea" readonly></textarea>
        </div>
    </div>

    <!--Notices-->
    <div id="noticeboard" style="position: absolute; bottom: 0px; overflow-y: scroll; width: 100%; max-height: 100%;"></div>

    <!--Canvas-->
    <div id="container">
        <div><canvas id="colorbarCanvas"></canvas></div>
    </div>
    <canvas id="threeCanvas"></canvas>

    <div class="main">
        <!--all files to be loaded onload of html file-->
        <script src="./ts/lib/CCapture.all.min.js"></script>
        <script src="./ts/lib/three.js"></script>
        <script src="./ts/lib/Lut.js"></script>
        <script src="./ts/lib/VRButton.js"></script>
        <script src="./ts/controls/DragControls.js"></script>
        <script src="./ts/controls/TrackballControls.js"></script>
        <script src="./dist/scene_setup.js"></script>
        <script src="./dist/instancing.js"></script>
        <script src="./dist/mesh_setup.js"></script>
        <script src="./dist/io.js"></script>
        <script src="./dist/PBC_switchbox.js"></script>
        <script src="./dist/file_reading.js"></script>
        <script src="./dist/doUndo.js"></script>
        <script src="./dist/rigid-body_simulation.js"></script>
        <script src="./dist/main.js"></script>
        <script src="./dist/keybindings.js"></script>
        <script src="./dist/base_selector.js"></script>
        <script src="./dist/output_file.js"></script>
        <script src="./dist/translation.js"></script>
        <script src="./ts/controls/SceneUtils.js"></script>
        <script src="./dist/adhoc_api.js"></script>
        <script src="./dist/editing.js"></script>
        <script src="./dist/video.js"></script>
        <script src="./dist/UI.js"></script>
        <script src="./dist/clustering.js"></script>
        <script src="./dist/vr.js"></script>
    </div>
</body>

</html>
